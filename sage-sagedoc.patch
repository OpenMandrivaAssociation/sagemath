diff -up sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/builder.py.orig sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/builder.py
--- sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/builder.py.orig	2012-10-20 10:55:40.186072764 -0300
+++ sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/builder.py	2012-10-20 10:55:58.251073456 -0300
@@ -11,7 +11,7 @@ except ValueError:
 from sage.misc.cachefunc import cached_method
 
 # Read options
-execfile(os.path.join(os.getenv('SAGE_ROOT'), 'devel', 'sage', 'doc', 'common' , 'build_options.py'))
+execfile(os.path.join(os.getenv('SAGE_ROOT'), 'devel', 'doc', 'common' , 'build_options.py'))
 
 ##########################################
 #          Utility Functions             #
diff -up sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/conf.py.orig sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/conf.py
--- sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/conf.py.orig	2012-10-20 10:56:10.794073936 -0300
+++ sage-5.4.beta1/spkg/build/sage-5.4.beta1/doc/common/conf.py	2012-10-20 10:57:59.403078095 -0300
@@ -1,7 +1,7 @@
 import sys, os, sphinx
 
-SAGE_ROOT = os.environ['SAGE_ROOT']
-SAGE_DOC = os.path.join(SAGE_ROOT, 'devel/sage/doc')
+SAGE_DEVEL = os.environ['SAGE_DEVEL']
+SAGE_DOC = os.environ['SAGE_DOC']
 
 def get_doc_abspath(path):
     """
@@ -178,8 +178,7 @@ if (os.environ.get('SAGE_DOC_MATHJAX', F
     from sage.misc.latex_macros import sage_mathjax_macros
     html_theme_options['mathjax_macros'] = sage_mathjax_macros
 
-    from pkg_resources import Requirement, working_set
-    sagenb_path = working_set.find(Requirement.parse('sagenb')).location
+    sagenb_path = SAGE_DEVEL
     mathjax_relative = os.path.join('sagenb','data','mathjax')
 
     # It would be really nice if sphinx would copy the entire mathjax directory,
diff -up sage-5.4.beta1/spkg/build/sage-5.4.beta1/sage/misc/sagedoc.py.orig sage-5.4.beta1/spkg/build/sage-5.4.beta1/sage/misc/sagedoc.py
--- sage-5.4.beta1/spkg/build/sage-5.4.beta1/sage/misc/sagedoc.py.orig	2012-10-20 10:58:36.656079522 -0300
+++ sage-5.4.beta1/spkg/build/sage-5.4.beta1/sage/misc/sagedoc.py	2012-10-20 10:59:31.267081613 -0300
@@ -701,13 +701,13 @@ def _search_src_or_doc(what, string, ext
         module = ''
         exts = ['html']
         title = 'Documentation'
-        base_path = os.path.join('devel', 'sage', 'doc', 'output')
-        doc_path = os.path.join(ROOT, 'devel', 'sage', 'doc')
+        base_path = os.path.join('devel', 'output')
+        doc_path = os.path.join(ROOT, 'devel', 'doc')
 
-        # We need to import stuff from SAGE_ROOT/devel/sage/doc/common
+        # We need to import stuff from SAGE_ROOT/devel/doc/common
         # To do this, we temporarily change sys.path
         oldpath = sys.path
-        sys.path = oldpath + [os.path.join(ROOT, 'devel', 'sage', 'doc', 'common')]
+        sys.path = oldpath + [os.path.join(ROOT, 'devel', 'doc', 'common')]
         import build_options as builder
         # List of languages
         lang = builder.LANGUAGES
